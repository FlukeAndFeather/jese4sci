---
title: "Function scope limits interference"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(palmerpenguins)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
```

## What is scope?

### New vocabulary

- _scope_ Which objects (data, functions, etc) are visible to a code block 
- _immutability_ An immutable variable cannot be changed

_Scope_ is a powerful tool for breaking down complex ideas into manageable chunks, but it's also a common source of frustration for coders new to writing functions. In this lesson you'll learn what variables are visible to a function (_scope_) and how R uses _immutability_ to reduce errors.

### Bills and flippers

For this lesson we're going to examine a morphological dataset of penguins from the Palmer Station Long Term Ecological Research site in Antarctica. For more information on the R package containing this data set (and the source of the excellent penguin illustration), see https://allisonhorst.github.io/palmerpenguins/.

![Illustrations of Chinstrap, Gentoo, and Ad√©lie penguins](https://allisonhorst.github.io/palmerpenguins/reference/figures/lter_penguins.png){width=300}

```{r}
ggplot(drop_na(penguins, flipper_length_mm, bill_length_mm), 
       aes(flipper_length_mm, bill_length_mm, color = species)) +
  geom_point(aes(shape = species), size = 2, alpha = 0.75) +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  labs(x = "Flipper length (mm)",
       y = "Bill length (mm)",
       color = "Penguin species",
       shape = "Penguin species") +
  scale_color_manual(values = c(Adelie = "#E4811E",
                                Chinstrap = "#B05CC5",
                                Gentoo = "#417175")) +
  theme_minimal() +
  theme(legend.box.background = element_rect(color = NA, fill = "white"),
        legend.justification = c(1, 0),
        legend.position = c(0.95, 0.05))
```

## Parameters as placeholders

Within the scope of a function, parameters take on the value passed in the function call. So the value visible within the function will change depending on how you call it. This may seem obvious, but it's easy to forget and a common source of bugs! Consider the following.

```{r}
ith_bill <- function(i) {
  bills <- sort(penguins$bill_length_mm, decreasing = TRUE)
  bills[i]
}

ith_bill(1)
ith_bill(5)
```

`ith_bill()` returns the `i`_th_ largest bill, where `i` is a parameter. So when you call `ith_bill(1)` you get the largest bill and `ith_bill(5)` is the 5th largest bill. But how about this?

```r
i <- 2
ith_bill(3)
```

```{r set-i, echo=FALSE}
question("Which bill will we get?",
         answer("2nd largest", message = "Not quite. We set `i` to 2 outside the function, but in the function it takes the value of 3 since we called `ith_bill(3)`."),
         answer("3rd largest", correct = TRUE))
```

This is an example of _scope_. The function `ith_bill()` sees `i` as whatever we pass to it when we call it, not whatever we did outside of it. Here we saw it with a number, but it's also true of more complex objects. Let's modify `ith_bill()` to take a subset of the `penguins` data frame as a parameter to demonstrate. Fill in the "???" below to find the largest Adelie penguin bill.

```{r df-param, exercise=TRUE}
ith_bill <- function(i, penguin_subset) {
  bills <- sort(penguin_subset$bill_length_mm, decreasing = TRUE)
  bills[i]
}
ith_bill(1, filter(penguins, species == "???"))
```

















































